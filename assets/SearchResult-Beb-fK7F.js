import{k as W,u as X,l as M,m as Z,y as ee,t as te,n as ae,p as L,q as w,v as a,x as se,w as le,z as ie,R as I,A as re,B as ne,D as ue,E as ce,F as oe,G as T,H as $,J as de,K as me,L as pe,M as he,N as ve,O as ye,Q as ge,S as be,T as U,U as fe,V as R}from"./app-yjG2kzMn.js";const He=["/","/editor-support.html","/advanced/adapter.html","/advanced/driver.html","/advanced/matcher-provider.html","/advanced/matcher.html","/advanced/plugin-info.html","/advanced/plugin-nesting.html","/advanced/requiring.html","/advanced/routing.html","/advanced/runtime-hook.html","/advanced/session-updating.html","/appendices/log.html","/appendices/overload.html","/appendices/rule.html","/appendices/session-state.html","/appendices/whats-next.html","/best-practice/data-storing.html","/best-practice/error-tracking.html","/best-practice/scheduler.html","/community/contact.html","/community/contributing.html","/developer/adapter-writing.html","/ospp/2021.html","/ospp/2022.html","/ospp/2023.html","/ospp/2024.html","/tutorial/application.html","/tutorial/create-plugin.html","/tutorial/fundamentals.html","/tutorial/matcher.html","/tutorial/message.html","/best-practice/alconna/command.html","/best-practice/alconna/config.html","/best-practice/database/user.html","/best-practice/testing/mock-network.html","/best-practice/database/developer/","/best-practice/database/developer/dependency.html","/best-practice/database/developer/test.html","/api/adapters/category_.json.html","/api/dependencies/category_.json.html","/api/drivers/category_.json.html","/api/plugin/category_.json.html","/best-practice/alconna/category_.json.html","/best-practice/database/category_.json.html","/best-practice/testing/category_.json.html","/best-practice/database/developer/category_.json.html","/404.html","/advanced/","/appendices/","/best-practice/","/community/","/developer/","/ospp/","/tutorial/","/best-practice/alconna/","/best-practice/database/","/best-practice/testing/","/api/adapters/","/api/","/api/dependencies/","/api/drivers/","/api/plugin/","/category/","/tag/","/Blog/","/star/","/timeline/"],ke="SLIMSEARCH_QUERY_HISTORY",y=U(ke,[]),we=()=>{const{queryHistoryCount:l}=R;return{enabled:l>0,queryHistories:y,addQueryHistory:n=>{y.value=Array.from(new Set([n,...y.value.slice(0,l-1)]))},removeQueryHistory:n=>{y.value=[...y.value.slice(0,n),...y.value.slice(n+1)]}}},_=l=>He[l.id]+("anchor"in l?`#${l.anchor}`:""),Re="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:F}=R,g=U(Re,[]),qe=()=>({enabled:F>0,resultHistories:g,addResultHistory:r=>{{const n={link:_(r),display:r.display};"header"in r&&(n.header=r.header),g.value=[n,...g.value.slice(0,F-1)]}},removeResultHistory:r=>{g.value=[...g.value.slice(0,r),...g.value.slice(r+1)]}}),xe=l=>{const r=de(),n=M(),q=me(),u=L(0),b=w(()=>u.value>0),d=pe([]);return he(()=>{const{search:x,terminate:p}=ve(),f=ge(h=>{const{resultsFilter:Q=s=>s,querySplitter:v,suggestionsFilter:D,...i}=r.value;h?(u.value+=1,x(h,n.value,i).then(s=>Q(s,h,n.value,q.value)).then(s=>{u.value-=1,d.value=s}).catch(s=>{console.warn(s),u.value-=1,u.value||(d.value=[])})):d.value=[]},R.searchDelay-R.suggestDelay,{maxWait:5e3});ye([l,n],([h])=>f(h.join(" "))),be(()=>{p()})}),{isSearching:b,results:d}};var Se=W({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:r}){const n=X(),q=M(),u=Z(ee),{addQueryHistory:b,queryHistories:d,removeQueryHistory:x}=we(),{resultHistories:p,addResultHistory:f,removeResultHistory:h}=qe(),Q=te(l,"queries"),{results:v,isSearching:D}=xe(Q),i=ae({isQuery:!0,index:0}),s=L(0),m=L(0),A=w(()=>d.value.length>0||p.value.length>0),S=w(()=>v.value.length>0),C=w(()=>v.value[s.value]||null),O=()=>{const{isQuery:e,index:t}=i;t===0?(i.isQuery=!e,i.index=e?p.value.length-1:d.value.length-1):i.index=t-1},P=()=>{const{isQuery:e,index:t}=i;t===(e?d.value.length-1:p.value.length-1)?(i.isQuery=!e,i.index=0):i.index=t+1},B=()=>{s.value=s.value>0?s.value-1:v.value.length-1,m.value=C.value.contents.length-1},Y=()=>{s.value=s.value<v.value.length-1?s.value+1:0,m.value=0},V=()=>{m.value<C.value.contents.length-1?m.value+=1:Y()},z=()=>{m.value>0?m.value-=1:B()},j=e=>e.map(t=>fe(t)?t:a(t[0],t[1])),G=e=>{if(e.type==="customField"){const t=ce[e.index]||"$content",[c,k=""]=oe(t)?t[q.value].split("$content"):t.split("$content");return e.display.map(o=>a("div",j([c,...o,k])))}return e.display.map(t=>a("div",j(t)))},H=()=>{s.value=0,m.value=0,r("updateQuery",""),r("close")},J=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},u.value.queryHistory),d.value.map((e,t)=>a("div",{class:["slimsearch-result-item",{active:i.isQuery&&i.index===t}],onClick:()=>{r("updateQuery",e)}},[a(T,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},e),a("button",{class:"slimsearch-remove-icon",innerHTML:$,onClick:c=>{c.preventDefault(),c.stopPropagation(),x(t)}})]))])),K=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},u.value.resultHistory),p.value.map((e,t)=>a(I,{to:e.link,class:["slimsearch-result-item",{active:!i.isQuery&&i.index===t}],onClick:()=>{H()}},()=>[a(T,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(c=>j(c)).flat())]),a("button",{class:"slimsearch-remove-icon",innerHTML:$,onClick:c=>{c.preventDefault(),c.stopPropagation(),h(t)}})]))]));return se("keydown",e=>{if(l.isFocusing){if(S.value){if(e.key==="ArrowUp")z();else if(e.key==="ArrowDown")V();else if(e.key==="Enter"){const t=C.value.contents[m.value];b(l.queries.join(" ")),f(t),n.push(_(t)),H()}}else if(e.key==="ArrowUp")O();else if(e.key==="ArrowDown")P();else if(e.key==="Enter"){const{index:t}=i;i.isQuery?(r("updateQuery",d.value[t]),e.preventDefault()):(n.push(p.value[t].link),H())}}}),le([s,m],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!S.value:!A.value}],id:"slimsearch-results"},l.queries.length?D.value?a(ie,{hint:u.value.searching}):S.value?a("ul",{class:"slimsearch-result-list"},v.value.map(({title:e,contents:t},c)=>{const k=s.value===c;return a("li",{class:["slimsearch-result-list-item",{active:k}]},[a("div",{class:"slimsearch-result-title"},e||u.value.defaultTitle),t.map((o,N)=>{const E=k&&m.value===N;return a(I,{to:_(o),class:["slimsearch-result-item",{active:E,"aria-selected":E}],onClick:()=>{b(l.queries.join(" ")),f(o),H()}},()=>[o.type==="text"?null:a(o.type==="title"?re:o.type==="heading"?ne:ue,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[o.type==="text"&&o.header?a("div",{class:"content-header"},o.header):null,a("div",G(o))])])})])})):u.value.emptyResult:A.value?[J(),K()]:u.value.emptyHistory)}});export{Se as default};
